/*
    @package jaxon
    @version $Id: jaxon.debug.js 327 2007-02-28 16:55:26Z calltoconstruct $
    @copyright Copyright (c) 2005-2007 by Jared White & J. Max Wilson
    @copyright Copyright (c) 2008-2009 by Joseph Woolley, Steffen Konerow, Jared White  & J. Max Wilson
    @license http://www.jaxonproject.org/bsd_license.txt BSD License
*/
try{if("undefined"==typeof jaxon)throw{name:"SequenceError",message:"Error: Jaxon core was not detected, debug module disabled."};void 0===jaxon.debug&&(jaxon.debug={}),jaxon.debug.active=!0}catch(e){alert(e.name+": "+e.message)}!function(e,t,n,s,r,o,a,i){e.windowSource="about:blank",e.windowID="jaxon_debug_window",e.windowStyle="width=800,height=600,scrollbars=yes,resizable=yes,status=yes",e.windowTemplate='<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html><head><title>jaxon debug output</title><style type="text/css">/* <![CDATA[ */.debugEntry { margin: 3px; padding: 3px; border-top: 1px solid #999999; } .debugDate { font-weight: bold; margin: 2px; } .debugText { margin: 2px; } .warningText { margin: 2px; font-weight: bold; } .errorText { margin: 2px; font-weight: bold; color: #ff7777; }/* ]]> */</style></head><body><h2>jaxon debug output</h2><div id="debugTag"></div></body></html>',e.isLoaded=!0,e.verbose.isLoaded=!1,e.verbose.active=!1;const c=function(t){if(void 0!==t.code){if(void 0!==e.exceptions[t.code]){const n=e.exceptions[t.code];return void 0!==t.data&&n.replace("{data}",t.data),n}}else if(void 0!==t.name){return void 0!==t.message?t.name+": "+t.message:t.name}return"An unknown error has occurred."};e.prepareDebugText=function(t){try{return t=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br />")}catch(n){const s=function(e,t,n){const s=e.split(t);e="";for(let t=0;t<s.length;++t)0!=t&&(e+=n),e+=s[t];return e};e.prepareDebugText=function(e){return e=s(e,"&","&amp;"),e=s(e,"<","&lt;"),e=s(e,">","&gt;"),e=s(e,"\n","<br />")},e.prepareDebugText(t)}},e.writeDebugMessage=function(t,n,s){try{e.window&&!e.window.closed||(e.window=window.open(e.windowSource,e.windowID,e.windowStyle),"about:blank"===e.windowSource&&e.window.document.write(e.windowTemplate)),void 0===n&&(n=""),void 0===s&&(s="debugText"),t=e.prepareDebugText(t);const r=e.window.document,o=r.getElementById("debugTag"),a=r.createElement("div"),i=r.createElement("span"),c=r.createElement("pre");i.innerHTML=(new Date).toString(),c.innerHTML=n+t,a.appendChild(i),a.appendChild(c),o.insertBefore(a,o.firstChild);try{a.className="debugEntry",i.className="debugDate",c.className=s}catch(e){}}catch(n){t.length>1500&&(t=t.substr(0,1500)+" ...\n(Truncated)"),alert(e.messages.heading+t)}};const u=()=>{const e=[];return function(t,n){if("object"!=typeof n||null===n)return n;if(n===window)return"[Window]";if(n===document)return"[Document]";for(;e.length>0&&e.at(-1)!==this;)e.pop();return e.includes(n)?"[Circular]":(e.push(n),n)}};e.stringify=e=>JSON.stringify(e,u(),2);const g=r.unregister("script.debug");r.register("script.debug",(({message:t})=>(e.writeDebugMessage(t,e.messages.warning,"warningText"),g({message:t}))));const d=r.execute;r.execute=function(t){const{sequence:n,command:{name:s,fullName:o,args:a}}=t;try{if(void 0===s)throw{code:10006};if(0==r.isRegistered({name:s}))throw{code:10007,data:s};return d(t)}catch(t){let s="jaxon.ajax.command.execute (";void 0!==n&&(s+="#"+n+", "),void 0!==o&&(s+='"'+o+'"'),void 0!==a&&(s+=e.stringify(a)),s+="):\n"+c(t)+"\n",e.writeDebugMessage(s,e.messages.error,"errorText")}return!0};const l=r.callHandler;r.callHandler=function(t,n,s){const{command:{fullName:r},component:o}=s;try{const a=l(t,n,s);return e.writeDebugMessage(e.messages.processing.calling.supplant({cmd:r||t,options:e.stringify({...o?{component:o}:{},args:n})})),a}catch(t){const n="jaxon.ajax.command.callHandler: "+c(t)+"\n";throw e.writeDebugMessage(n,e.messages.error,"errorText"),t}};const m=i.dom.$;i.dom.$=function(t){try{let e=m(t);if("object"!=typeof e)throw{code:10008};return e}catch(t){const n="$:"+c(t)+"\n";e.writeDebugMessage(n,e.messages.warning,"warningText")}};const p=n._send;n._send=function(t){try{const n=t.requestData.length||0;e.writeDebugMessage(e.messages.request.sending),t.beginDate=new Date,p(t),e.writeDebugMessage(e.messages.request.sent.supplant({length:n}))}catch(t){const n="jaxon.ajax.request._send: "+c(t)+"\n";throw e.writeDebugMessage(n,e.messages.error,"errorText"),t}};const x=n.submit;n.submit=function(t){let n=t.method+": "+t.URI+"\n",s=decodeURIComponent(t.requestData);s=s.replace(new RegExp("&jxn","g"),"\n&jxn"),n+=s,e.writeDebugMessage(n),n=e.messages.request.calling;for(let e in t.functionName)n+="\n"+e+": "+t.functionName[e];e.writeDebugMessage(n);try{return x(t)}catch(n){if(e.writeDebugMessage(n.message),0<t.retry)throw n}};const w=n.initialize;n.initialize=function(t){try{const n=e.messages.request.init;return e.writeDebugMessage(n),w(t)}catch(t){const n="jaxon.ajax.request.initialize: "+c(t)+"\n";throw e.writeDebugMessage(n,e.messages.error,"errorText"),t}};const f=t.process;t.process=function(t){try{if(void 0!==t.parameters){const n=e.messages.processing.parameters.supplant({count:t.parameters.length});e.writeDebugMessage(n)}else{const t=e.messages.processing.no_parameters;e.writeDebugMessage(t)}return f(t)}catch(t){const n="jaxon.ajax.parameters.process: "+c(t)+"\n";throw e.writeDebugMessage(n,e.messages.error,"errorText"),t}};const b=n.prepare;n.prepare=function(t){try{const n=e.messages.request.preparing;return e.writeDebugMessage(n),b(t)}catch(t){const n="jaxon.ajax.request.prepare: ";throw c(t),e.writeDebugMessage(n,e.messages.error,"errorText"),t}};const j=n.execute;n.execute=function(){try{e.writeDebugMessage(e.messages.request.starting);const t=arguments.length;if(0==t)throw{code:10010};const n=arguments[0],s=1<t?arguments[1]:{};return s.debugging=!0,j(n,s)}catch(t){const n="jaxon.ajax.request.execute: "+c(t)+"\n";throw e.writeDebugMessage(n,e.messages.error,"errorText"),t}};const h=s.received;s.received=function(t){try{const n=t.response.status;if(s.isSuccessCode(n)){t.midDate=new Date;const s=e.messages.response.success.supplant({status:n,length:e.stringify(t.responseContent).length,duration:t.midDate-t.beginDate})+"\n"+e.stringify(t.responseContent);e.writeDebugMessage(s)}else if(s.isErrorCode(n)){const s=e.messages.response.content.supplant({status:n,text:e.stringify(t.responseContent)});e.writeDebugMessage(s,e.messages.error,"errorText")}else if(s.isRedirectCode(n)){const n=e.messages.response.redirect.supplant({location:t.response.headers.get("location")});e.writeDebugMessage(n)}return h(t)}catch(t){const n="jaxon.ajax.response.received: "+c(t)+"\n";e.writeDebugMessage(n,e.messages.error,"errorText")}return null};const D=s.complete;s.complete=function(t){try{let n=D(t);t.endDate=new Date;const s=t.endDate-t.beginDate,r=e.messages.processing.done.supplant({duration:s});return e.writeDebugMessage(r),n}catch(t){const n="jaxon.ajax.response.complete: "+c(t)+"\n";throw e.writeDebugMessage(n,e.messages.error,"errorText"),t}};const y=jaxon.cmd.node.assign;jaxon.cmd.node.assign=function({target:t,prop:n,data:s}){try{return y(t,n,s)}catch(r){const o="jaxon.cmd.node.assign: "+c(r)+"\nEval: element."+n+" = data;\n"+e.stringify({target:t,prop:n,data:s})+"\n";e.writeDebugMessage(o,e.messages.error,"errorText")}return!0};const M=o.execCommand;o.execCommand=(e,t)=>{t=M(e,t);const n={select:"selector",event:"event handler",attr:"attribute",func:"function"}[e._type]??`[unknown(${e._type})]`;return console.log(`Call parser has called ${n} ${t.call}.`),t};const T=a.select;a.select=(t,n=null)=>{const s=e.stringify(t);try{const r=T(t,n),o="jaxon.parser.query.select("+s+") using "+(a.jq===window.jQuery?"jQuery":a.jq===window.chibi?"Chibi":"[Custom]")+"\n";return e.writeDebugMessage(o,e.messages.info),r}catch(t){const n="jaxon.parser.query.select("+s+"): "+c(t)+"\n";e.writeDebugMessage(n,e.messages.error,"errorText")}}}(jaxon.debug,jaxon.ajax.parameters,jaxon.ajax.request,jaxon.ajax.response,jaxon.ajax.command,jaxon.parser.call,jaxon.parser.query,jaxon.utils),jaxon.dom.ready((function(){(function(self,debug){if(!self.active)return;const makeFunction=function(obj,name){return function(){let fun=name+"(",separator="";const pLen=arguments.length;for(let e=0;e<pLen;++e)fun+=separator,fun+=debug.stringify(arguments[e]),separator=",";fun+=");";let msg="--\x3e "+fun;debug.writeDebugMessage(msg);let returnValue=!0,code="returnValue = obj(";separator="";for(let e=0;e<pLen;++e)code+=separator+"arguments["+e+"]",separator=",";return code+=");",eval(code),msg="<-- "+fun+" returns "+debug.stringify(returnValue),debug.writeDebugMessage(msg),returnValue}};self.hook=function(e,t){for(let n in e)"function"==typeof e[n]&&(e[n]=makeFunction(e[n],t+n))},self.hook(jaxon,"jaxon."),self.hook(jaxon.cmd.node,"jaxon.cmd.node."),self.hook(jaxon.cmd.event,"jaxon.cmd.event."),self.hook(jaxon.cmd.script,"jaxon.cmd.script."),self.hook(jaxon.utils.dom,"jaxon.utils.dom."),self.hook(jaxon.utils.string,"jaxon.utils.string."),self.hook(jaxon.utils.queue,"jaxon.utils.queue."),self.hook(jaxon.utils.upload,"jaxon.utils.upload."),self.hook(jaxon.ajax.callback,"jaxon.ajax.callback."),self.hook(jaxon.ajax.command,"jaxon.ajax.command."),self.isLoaded=!0})(jaxon.debug.verbose,jaxon.debug)}));